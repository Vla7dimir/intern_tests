{% extends "base.html" %}
{% block title %}Добавить воспоминание — Places Remember{% endblock %}
{% block content %}
<h4 class="mb-3">Добавить воспоминание</h4>
<p class="text-muted">Выберите место на карте, затем заполните название и комментарий.</p>
<div id="map" class="rounded border mb-4" style="height: 350px;"></div>
<form method="post" id="memory-form">
  {% csrf_token %}
  {{ form.lat }}
  {{ form.lng }}
  <div class="mb-3">
    <label for="id_title" class="form-label">{{ form.title.label }}</label>
    {{ form.title }}
    {% if form.title.errors %}<div class="invalid-feedback d-block">{{ form.title.errors }}</div>{% endif %}
  </div>
  <div class="mb-3">
    <label for="id_comment" class="form-label">{{ form.comment.label }}</label>
    {{ form.comment }}
    {% if form.comment.errors %}<div class="invalid-feedback d-block">{{ form.comment.errors }}</div>{% endif %}
  </div>
  <button type="submit" class="btn btn-success">Сохранить</button>
  <a href="{% url 'places_remember:index' %}" class="btn btn-outline-secondary">Отмена</a>
</form>
{% endblock %}
{% block extra_js %}
<script>
(function() {
  var lat = parseFloat(document.getElementById('id_lat').value) || 55.7558;
  var lng = parseFloat(document.getElementById('id_lng').value) || 37.6173;
  var map = L.map('map').setView([lat, lng], 10);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);
  var marker = L.marker([lat, lng]).addTo(map);
  map.on('click', function(e) {
    marker.setLatLng(e.latlng);
    document.getElementById('id_lat').value = e.latlng.lat.toFixed(6);
    document.getElementById('id_lng').value = e.latlng.lng.toFixed(6);
  });
})();
</script>
{% endblock %}
